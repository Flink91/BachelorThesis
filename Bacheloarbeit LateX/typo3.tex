\chapter{Typo3 - Eine Übersicht}
\label{kap-typo3}

Die Wahl des CMS fiel nun durch die ausreichende Recherche im vorigen Kapitel auf Typo3 und wird als Grundlage für alle technischen Aspekte dienen, weshalb Typo3 in dieser Bachelorarbeit einen essentiellen Teil ausmacht. In diesem Kapitel werden zunächst alle nötigen Grundlagen rund um Typo3 geklärt, um im anschließenden Kapitel die Anpassung eines Typo3 Systems an die zuvor gesammelten Anforderungen informiert vornehmen zu können.

Die meisten hier präsentierten Informationen entspringen den offiziellen Typo3 Docs\footnote{https://docs.typo3.org/} und einem Lernkurs des Rheinwerk Verlages zur neuen Typo3 Version 7\cite{typo3cms7}. Spezifische Verweise werden natürlich extra angegeben.

\section{Version und Hintergrund}
Typo3 ist ein Open Source CMS, ursprünglich entwickelt von Kasper Skårhøj und basiert auf der Programmiersprache PHP. Die Entwicklung begann bereits 1997 als Nebenprodukt von Skårhøjs Tätigkeit als Webdesigner. Der Name Typo3 enstand, nachdem Skårhøj durch einen Schreibfehler (engl. Typo) die Arbeit mehrerer Tage löschte. Die Zahl 3 ist der damals aktuellen Version geschuldet, wurde jedoch weiterhin beibehalten. Das System ist Open Source unter der GPL-Lizenz. Bei der Popularität von Open Source Web Content Management Systemen belegt Typo3, je nach Quelle, meist den fünften Platz\footnote{http://trends.builtwith.com/cms/open-source Mai 2016: Platz 5}. Typo3 umfasst eine Fülle an Versionen und spaltete sich 2015 sogar in zwei verschiedene Kernentwicklungsteams. Eines das weiter an Typo3 CMS arbeitet und eines, das an Typo3 Neos arbeitet. Diese Bachelorarbeit basiert auf der neuesten Version von Typo3 CMS 7.6 LTS. Version 8 wird jedoch auch noch 2016 veröffentlicht.

\section{Installation}

Die Installation und Erstellung einer Typo3 Website gestaltet sich relativ umfangreich. Je nach Vorhaben muss mit komplexen Einstellungen am serverseitigen System experimentiert werden. Zum Zweck der Entwicklung bietet es sich jedoch an das Typo3 System zunächst lokal zu installieren. Der hierfür nötige Server kann entweder durch ein Programm wie Wamp oder Xampp, welche eine fertige Apache-Distribution liefern, bereitgestellt werden oder durch das Installieren eines Servers auf einer virtuellen Maschine. Die vorgenommenen Implementationen in Kapitel 4 wurden mit Wamp\footnote{http://www.wampserver.com} realisiert.

\section{Frontend Struktur}
Das Frontend ist von Typo3 in bestimmte Bereiche unterteilt:
\begin{itemize}
\item Header - Zeigt Inhalte ganz oben auf der Website, wie ein Logo
\item Menü - Beinhaltet das Hauptmenü
\item Content - Unterteilt sich in drei Teile, Links, Mitte und Rechts
\item Footer - Zeigt Inhalte am Ende der Webseite
\end{itemize}

Wo genau diese Bereiche auftauchen lässt sich mittels eines Templates definieren, das mit Typoscript beschrieben wird. Im Backend finden sich genau diese Teile wieder und lassen sich dort mit Content befüllen.

\section{Bedienung}

Typo3 generiert letztendlich eine Website. Diese lässt sich jedoch durch das Typo3 Backend entscheidend verändern. Die Bedienung geschieht fast immer durch dieses Backend, welches von der Startseite aus durch das Anhängen von \texttt{/typo3} in der Adresszeile zu erreichen ist. Hier werden im Grunde drei Aufgaben erledigt. Templates erstellen um das Design der Website anzupassen, Typo3 Konfigurationen vornehmen und die Erstellung von Inhalten. 

\begin{figure}[ht]
	\includegraphics[scale=0.5]{abb/typo3frontend.jpg}
	\caption{Das Frontend gleicht einer normalen Website.}%
	\label{fig:typo3backend}
\end{figure}

\begin{figure}[ht]
	\includegraphics[scale=0.5]{abb/typo3backend.jpg}
	\caption{Das Typo3 Backend}%
	\label{fig:typo3backend}
\end{figure}

Das größte visuelle Merkmal der neuen Typo3 Version 7.6 LTS ist das neue, klarere Design des Backend von Typo3. So wird es für Anwender ohne Programmierkenntnisse einfacher sich zurechtzufinden und Inhalte zu erstellen. Dies geschieht hauptsächlich über einen integrierten WYSIWYG-Editor.

Dennoch enthält die Backend sehr viele Optionen, versteckte Knöpfe und Eigenheiten, die einer Erklärung bedürfen.

\section{Funktionalität und Architektur von Typo3}

Es handelt sich an dieser Stelle zwar um eine wissenschaftliche Arbeit und kein Handbuch, doch es ist ein wesentlicher Bestandteil dessen, die Typo3 Umgebung zu verstehen um analysieren zu können, wie sie am geschicktesten auf die gesammelten Anforderungen anzupassen ist. Daher folgt nun eine komprimierte Übersicht über den Umgang und die Entwicklung von Typo3 Websites und den Workflow beim Erstellen dieser.

\subsection{Die Backend Module im Überblick}

Das Backend sieht seit dem Update deutlich einladender aus, die Bedienung gestaltet sich jedoch immer noch anspruchsvoller als bei vergleichbaren Konkurrenten. Deshalb findet sich hier zunächst eine Liste mit Erklärungen zur Navigationsleiste im Backend:\\
\begin{wrapfigure}{lh!}{0.25\textwidth}
	\begin{center}
		\includegraphics[width=0.25\textwidth]{abb/typo3menu.jpg}
	\end{center}
	\caption{Typo3 Backend Menü}
\end{wrapfigure}
\begin{itemize}
	
	\item Page: Hier lassen sich die Einzelseiten der Webanwendung auf einem hohen Level erstellen und verwalten. Auch wenn noch keine Seite angelegt wurde, sieht man im Hierarchiebaum bereits einen Eintrag. Dieser stellt sozusagen die Wurzel aller zukünftigen Seiten dar, zeigt selbst jedoch keine Seite an.
	
	\item View: Hier ist es möglich, das Frontend zu begutachten, ohne das Backend zu verlassen.
	
	\item List: In diesem Menüpunkt findet sich eine Übersicht der Elemente, die dem Seitenbaum zugeordnet sind. Das können Webseiten oder auch Kompontenten von Plugins sein.
	
	\item Info: Hier lassen sich lediglich Informationen, wie zum Beispiel Erstelleungsdatum, zu einzelnen Komponenten anzeigen.
	
	\item Functions: Dieser Bereich beherbergt einige nützliche Hilfsfunktionen, um schneller Änderungen, wie Seitensortierung, durchzuführen. 
	
	\item Template: Hier werden alle Templates der Seite verwaltet.
	
	\item Filelist: Hier werden alle Dateien des sogenannten Filemount verwaltet. Meist handelt es sich um Dateien, die Redakteure in Einträge integrieren. Aber auch schnelle Änderungen an CSS-Dateien lassen sich hier durch einen integrierten Texteditor vornehmen.
	
	\item Extensions: In diesem Bereich werden alle installierten Erweiterungen gelistet. Man hat dort die Möglichkeit diese zu aktivieren und deaktivieren. Zu bemerken ist, dass das nicht mit allen Erweiterungen möglich ist, da einige Grundfunktionalitäten vonTypo3 auch als Erweiterungen gelistet sind und diese lassen sich nicht manipulieren. Darüber hinaus lassen sich hier neue Erweiterungen suchen und herunterladen.
	
	\item Languages: Dieser Punkt hilft bei der Verwaltung von mehrsprachigen Seiten. Auch das Backend lässt sich in mehreren Sprachen anzeigen.
	
	\item Access:
	
	\item Backend users: Hier lassen sich die Nutzer des Backend verwalten. Es lassen sich neue Backend User anlegen und auch spezifische Rechte dieser User konfigurieren. Typische Rollen sind Administrator/-in und Redakteur/-in.
	
	\item Install: Hier lassen sich durch das Install-Tool einige gravierende Einstellungen vornehmen, wie das Zurücksetzen von Passwörtern und ähnlichen Interaktionen mit der Datenbank. Außerdem zeigt diese Unterseite die Konfigurationsdetails der Umgebung an.
	
	\item Log: In diesem Bereich findet sich ein Protokoll über alle Nutzeraktionen und aufkommende Fehler.
	
	\item DB check: Hier lassen sich Statistiken über die Einträge der Datenbank anzeigen und Suchen in der Datenbank direkt durchs Backend durchführen.
	
	\item Configuration: In diesem Punkt findet sich eine recht unübersichtliche Liste von Konfigurationsvariablen.
	
	\item Reports: Der Report liefert eine Liste von Nachrichten über den Lauf der Webseite und mögliche Probleme.
	
\end{itemize}


\subsection{Typoscript}

Typoscript ist die Skriptsprache von Typo3. Es handelt sich dabei nicht um eine richtige Programmiersprache, was sich auch schon vom Namen her vermuten lassen könnte. Das zeigt sich auch in der Art und Weise wie Typoscript von Typo3 verarbeitet wird, nämlich als sehr langes PHP Array und einem internen Parser. Typoscript ist mehr dafür ausgelegt dem Ersteller der Webseite eine Möglichkeit zu geben, zu bestimmen, wie Typo3 mit bestimmten Objekten, wie zum Beispiel Bildern, Menüs oder Templates, umgehen soll. Es ist so also hauptsächlich für die spezifische Ausgabe von Content zuständig.
In Typoscript wird immer mit Objekten gearbeitet, denen man bestimmte Eigenschaften zusprechen kann.

Eine Typoscript Datei, die in jedem Template enthalten ist, ist die setup.ts. Aus dieser ist nun ein kleiner Schnipsel zu sehen.

\begin{verbatim}
page = PAGE
page{
 includeCSS.style = fileadmin/Template_WegE/bootstrap/css/style.css

 10 = FLUIDTEMPLATE
 10{
  file = fileadmin/Template_WegE/index.html
  layoutRootPath = fileadmin/Template_WegE/layouts/
  partialRootPath = fileadmin/Template_WegE/partials/

  variables{
	siteName = TEXT
	siteName.value = WegE Fallstudie

	content < styles.content.get
  }
 }
}
\end{verbatim}

Zu Beginn wird eine Variable mit dem Namen page gesetzt, welche die ganze Seite präsentiert. Diese bekommt in Zeile 3 ein neues Stylsheet zugewiesen, das dann automatisch eingebunden wird. Danach wird eine Variable zum Fluidtemplate. Die Zahl 10 präsentiert dabei einen Platz im PAGE Array, das danach aus Typoscript generiert wird. Hier ist die Reihenfolge oft wichtig. Es ist üblich Anweisungen mit in Zehnerschritten zu nummerieren, sodass man später eventuell vergessene Anweisungen noch zwischen zwei Zahlen einfügen kann. Für das Fluidtemplate werden nun die Pfade zu den Layouts und Partials definiert. Layouts und Partials sind Einzelteile eines Templates. Genaueres dazu im Verlauf dieses Kapitels.
Darunter wird noch mittels Typoscript der Name der Seite definiert, welcher später an vielen Stellen verwendet werden kann.

\subsection{Erweiterungen/Extensions}

Ein großer Vorteil und Grund für die Wahl von Typo3 als CMS sind die Erweiterungen oder Extensions. Inzwischen existieren tausende von Erweiterungen für Typo3. Allerdings muss dazugesagt werden, dass ein großer Teil dieser veraltet ist, nicht mehr gepflegt wird oder gar überhaupt nicht auf der neuen Version lauffähig gemacht werden kann. Das liegt auch daran, dass viele der Extensions von freien Programmierern in ihrer Freizeit entwickelt werden.
Zu finden sind diese Extensions auf der offiziellen Seite unter typo3.org/extensions/repository. Wichtig ist es hier auf die Kompatibilität zu achten, die dort angezeigt wird. Auch findet sich hier meist eine Dokumentation zur Einrichtung und weiteren Infos zur jeweiligen Erweiterung. 
Die Erweiterungen der eigenen Typo3 Anwendung lassen sich durch den Menüpunkt \emph{Erweiterungen} im Backend verwalten.

\subsection{Templates erstellen}

Beim Erstellen einer Typo3 Website bekommt der Entwickler für gewöhnlich ein Frontend Design der Seite geliefert und hat dann die Aufgabe dieses Design in Typo3 zu integrieren. Das geschieht durch das Schreiben von Typoskript, das Installieren von Extensions, der Anpassung des Backend und die Entwicklung von Templates. Der Begriff Template ist bei Typo3 mehrfach belegt, deshalb vorerst eine Unterscheidung:

\begin{itemize}
	\item HTML-Template: Die HTML-Vorlage, welche meist ein Designer liefert.
	\item TypoScript-Template: Alle Typoscript-Anweisungen, die Ausgabe von Menüs und Ähnlichem steuern.
	\item Fluidtemplate: Mit Typo3 lassen sich im HTML-Code Fluid-Funktionen  verwenden. Diese erlauben Variablen, Bedingungen und das Aufteilen des HTML-Codes in Partials.
\end{itemize}

Ein Typo3 Fluidtemplate besteht also aus einem Layout, das Dinge wie head und header enthalten kann, einem Template, das den Inhalt repräsentiert und Partials, die mehrmals auf einer Seite vorkommen können.

\begin{figure}
\centering
\includegraphics[width=0.7\linewidth]{abb/typo3_template_overview.png}
\caption[Typo3 Template Teile]{Typo3 Template Komponenten}
\label{fig:typo3_template_overview}
\end{figure}

Im Folgenden geht es vor Allem um das Fluidtemplate, welches aus dem HTML-Template erzeugt wird. Für das Fluidtemplate ist es heutzutage üblich eine Template-Extension zu erstellen. Das bedeutet, dass das Template in einzelnen Dateien auffindbar ist, statt in der Datenbank, was die Versionierung und Weitergabe eines Templates erheblich vereinfacht. Da die Teamarbeit durch Dienste wie Git äußerst populär geworden ist, wird diese Methode der Template-Entwicklung bevorzugt.

Zu Beginn einer neuen Template-Extension hilft eine Typo3 Extension weiter. Diese findet sich unter dem Namen \textit{extension\_builder}. Dieser Builder erzeugt im Backend einen neuen Menüpunkt unter dem sich im Unterpunkt Domain Modeling eine neue Template-Extension erstellen lässt. Diese taucht dann auch in der Extension-Liste auf.

Für die Arbeit mit den Dateien des erstellten Templates wird ein externer Editor benötigt. Im besten Fall sollte dieser auch mit Typoscript umgehen können, was die Wahl deutlich einschränkt. Zwei gute Optionen sind hier die IDEs UltraEdit und Webstorm. 

Da der Fokus dieser Arbeit mehr auf der Umsetzung funktionaler Anforderungen liegt, wird an dieser Stelle nicht weiter auf die Möglichkeiten zum designen von Typo3 Webseiten eingegangen. Für die beispielhafte Umsetzung der Anforderungen wird ein einfaches Bootstrap Gerüst verwendet.

\section{Beispielinstallation}

In diesem Unterpunkt wird der tatsächliche Installationsprozess der Testumgebung, inklusive einem Blick auf den Code, dokumentiert. Da sich diese Installationsanleitung sehr praktisch gestaltet, sollten die Versionen der genutzten Software beachtet werden, da hier schnell Änderungen auftreten können. Die Testumgebung läuft mit Typo3 7.6 LTS und Wamp 3.0.0 mit PHP 5.6. Wichtig hierbei ist vor Allem die Typo3 Version. Es wird mit Bootstrap Version 3 gearbeitet.

\paragraph{Typo 3 Installationsschritte}
\begin{enumerate}
	
	\item Typo3 7.6 LTS herunterladen.
	\item Wamp oder vergleichbares Programm herunterladen und installieren.
	\item Den Typo3 Ordner in den \texttt{www}-Ordner von Wamp (htdocs bei XAMPP) verschieben
	\item Nach dem Starten von Wamp zu \texttt{localhost/\textit{typo3Ordner}} navigieren.
	\item Es erscheint ein Installationsguide und wahrscheinlich eine Reihe von Fehlern, die zu beheben sind
	\item Die \texttt{php.ini} öffnen
	\subitem Die Variable \texttt{memory\_limit} erhöhen auf 64 oder höher
	\subitem Die Variable \texttt{upload\_max\_filesize} auf mindestens 10MB erhöhen
	\subitem Die Variable \texttt{max\_execution\_time} auf 240 setzen
	\item Die OpenSSL Extension muss als Systemvariable gesetzt werden. Unter Systemvariablen die Variable mit dem Namen \texttt{OPENSSL\_CONF} und dem Wert des Pfades zur openssl.cnf angeben. Danach eventuell Computer neu starten.
	\item Die PHP Extension Fileinfo geht nicht. In der php.ini das Semikolon vor \texttt{extension=php\_fileinfo.dll} entfernen.
	\item Windows Apache Thread Stack Size Fehler. Dieser kann in der httpd.conf Datei angepasst werden. Hier folgenden Codeschnipsel ans Ende der Datei kopieren:\\ \texttt{<IfModule mpm\_winnt\_module> ThreadStackSize 8388608 </IfModule>}
	\item Alle Dienste von Wamp neu starten und zum Installationstool von Typo3 zurückkehren. Im nächsten Schritt wird eine Datenbank benötigt. Will man diese selbst anlegen hilft das Tool phpmyadmin unter localhost/phpmyadmin. Hier lässt sich mit einem Klick eine leere Datenbank anlegen.
	\item Typo3 verlangt beim Anlegen der Datenbank auch den Port. Dieser lässt sich in der Konsole mit dem Befehl netstat -a -o auslesen. Hierzu vergleicht man die angezeigte PID mit dem Wamp Prozess im Taskmanager. Für gewöhnlich ist der Port eine Zahl um die 3000.
	\item Nun lässt sich das Backend, durch das Anhängen von /typo3 in der Adresszeile, aufrufen.
	
\end{enumerate}

\paragraph{Template-Erstellung Schritte} 

Der Vorteil eines CMS ist die Erstellung von dynamischem Content. Um das zu bewerkstelligen braucht es ein Template zum Anzeigen dieser Inhalte. Für die Testumgebung wurde ein rudimentäres Template basierend auf dem Bootstrap Framework installiert. Das Bootstrap Framework sorgt ohne viel Arbeit für ein besseres Aussehen der Webseite und Responsivität, d.h. eine automatische Anpassung an alle Bildschirmgrößen.


\begin{enumerate}
	
	\item Bootstrap 3 herunterladen.
	\item Bootstrap Starter Template herunterladen durch das Kopieren des Quellcodes (F12). Diese vorerst als \texttt{index.html} abspeichern.
	\item In der \texttt{index.html} alle href-Links an die neue Umgebung anpassen. Der vollständige Code findet sich im Anhang.
	\item Einen neuen Ordner im Verzeichnis fileadmin anlegen. Dieser hält das Template.
	\item Hier die \texttt{index.html} und den bootstrap Ordner ablegen. Dazu drei neue Ordner anlegen mit den Namen \texttt{layouts}, \texttt{partials} und \texttt{ts}.
	\item Im Backend unter dem Menüpunkt Template muss das Bootstrap Template im Root der Webseite angelegt werden. Sollte dieser nicht existieren, kann dieser unter \texttt{Page} angelegt werden.
	\begin{figure}
		\centering
		\includegraphics[width=0.3\linewidth]{abb/roottemplate.jpg}
		\caption{Aufbau Website-Baum}
		\label{fig:roottemplate}
	\end{figure}
	\item Im Root-Template unter \texttt{Includes} müssen zwei Dinge eingefügt werden, \texttt{css\_styled\_content} und \texttt{fluid\_styled\_content}. Die Reihenfolge ist dabei wichtig. Sollte \texttt{fluid\_styled\_content} nicht existieren, muss dieses als Extension installiert werden.
	\item Unter \texttt{General} werden nun zwei externe Typoscript Dateien für die Konstanten und das Setup verlinkt. So erhält man mehr Flexibilität bei der Arbeit mit Versionierungen und Teamarbeit.
	\subitem Unter \texttt{Constants} wird Folgendes geschrieben: \texttt{<INCLUDE\_TYPOSCRIPT: source=" FILE:fileadmin/\textit{Template\_WegE}/ts/constants.ts">}
	\subitem Unter \texttt{Setup}: \texttt{<INCLUDE\_TYPOSCRIPT: source= " FILE:fileadmin/\textit{Template\_WegE}/ts/setup.ts">}
	\subitem Die zwei verlinkten Dateien müssen nun auch im ts-Ordner erstellt werden.
	\item Die setup.ts benötigt nun einiges an Code, der aus der index.html übertragen wird. Diese enthält dann nur noch den Code zwischen den body-tags. Die fertige Datei ist im Anhang zu finden. 
	\item Die Teile aus der index.html, die nun wegfallen, werden in der setup.ts angelegt. Dafür ist ein PAGE Objekt nötig, welches alle referenzierten Dateien, wie bootstrap.css, einbindet. Die komplette Datei ist im Anhang zu finden. Die Inhalte, die das Template der Testumgebung dynamisch erstellt werden sollen beschränken sich auf das Menü und den Seitentitel. Nachdem diese Datei angelegt ist, wird das Menü automatisch mit den erstellten Seiten aus dem Typo3 Backend gefüllt.
	
\end{enumerate} 

Nach dem Anlegen eines rudimentären, aber voll funktionsfähigem Template, kann mit dem Erstellen von Content, beziehungsweise dem Installieren und Testen von Extensions, begonnen werden.
